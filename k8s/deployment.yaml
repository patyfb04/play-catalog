apiVersion: apps/v1
kind: Deployment
metadata:
  name: play-catalog
spec:
  replicas: 1
  selector:
    matchLabels:
      app: play-catalog
  template:
    metadata:
      labels:
        app: play-catalog
    spec:
      serviceAccountName: play-catalog-sa
      containers:
        - name: play-catalog
          image: playeconomyapp.azurecr.io/play-catalog:latest
          ports:
            - containerPort: 80
          env:
            # Cosmos DB connection string from Kubernetes Secret
            - name: CosmosDbSettings__ConnectionString
              valueFrom:
                secretKeyRef:
                  name: cosmosdb-connection
                  key: CosmosDbSettings__ConnectionString

            # Database name (safe to hardcode)
            - name: CosmosDbSettings__DatabaseName
              value: "Catalog"

            # Service Bus namespace (Managed Identity)
            - name: AzureServiceBusSettings__FullyQualifiedNamespace
              value: "playeconomy-servicebus.servicebus.windows.net"

            # MassTransit retry settings (optional but recommended)
            - name: MassTransitSettings__Retries
              value: "3"
            - name: MassTransitSettings__TimeIntervalInSeconds
              value: "5"

            # Identity service URL (internal)
            - name: ServiceSettings__Authority
              value: "http://play-identity"

            # Frontend origin (internal)
            - name: AllowedOrigin
              value: "http://play-frontend"

            # Service name for endpoint naming
            - name: ServiceSettings__ServiceName
              value: "play-catalog"
